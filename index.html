<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gerador Minecraft Avançado</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: white;
  color: black;
  max-width: 900px;
  margin: auto;
  padding: 20px;
}

h1 { font-size: 24px; margin-bottom: 20px; text-align: center; }

.card {
  background: #e0e0e0;
  padding: 16px;
  border-radius: 8px;
  margin-bottom: 16px;
  box-sizing: border-box;
}

button, input, select, textarea {
  font-size: 14px;
}

button {
  cursor: pointer;
  font-weight: bold;
  border: none;
  background: #d0d0d0;
  border-radius: 6px;
  transition: background 0.2s;
}

button:hover { background: #c0c0c0; }

.item, .folder {
  background: #f0f0f0;
  padding: 12px;
  margin: 4px;
  border-radius: 6px;
  box-sizing: border-box;
}

.folder {
  background: #d9d9ff;
}

.small { font-size: 12px; opacity: 0.7; display: block; margin-top: 4px; }

input[type="checkbox"] { width:auto; margin-right:6px; vertical-align:middle; }
input[type="file"] { padding:4px; }
textarea { resize: vertical; }
select { padding:6px; }
#itemsContainer { display:flex; flex-wrap:wrap; gap:10px; }
.item, .folder { width: calc(33% - 10px); }

</style>
</head>

<body>

<h1>Gerador Minecraft Avançado</h1>

<input type="hidden" id="mode" value="resource">

<div style="display:flex; gap:10px; margin-bottom:12px;">
  <button type="button" onclick="setPage('resource')">Resource Pack</button>
  <button type="button" onclick="setPage('datapack')">Datapack</button>
</div>

<div class="card" id="pageTitle"></div>

<div class="card">
  <label>Nome do projeto</label>
  <input id="projectName">

  <label>Descrição</label>
  <textarea id="projectDesc"></textarea>

  <label>Projetos salvos</label>
  <select id="savedProjects" onchange="loadProject()">
    <option value="">— selecionar —</option>
  </select>

  <button type="button" onclick="newProject()">Novo projeto</button>
</div>

<div class="card">
  <h3>Itens / Blocos / Pastas</h3>
  <div id="itemsContainer"></div>
  <button type="button" onclick="addFolder()">Adicionar Pasta</button>
  <button type="button" onclick="addItem()">Adicionar Item</button>
</div>

<button type="button" onclick="exportPack()">Exportar</button>

<script>
let terracotaAndTiles = [
  "white_terracotta","orange_terracotta","magenta_terracotta",
  "light_blue_terracotta","yellow_terracotta","lime_terracotta",
  "pink_terracotta","gray_terracotta","light_gray_terracotta",
  "cyan_terracotta","purple_terracotta","blue_terracotta",
  "brown_terracotta","green_terracotta","red_terracotta",
  "black_terracotta",
  "terracotta","minecraft:bricks","minecraft:stone_bricks",
  "minecraft:deepslate_tiles","minecraft:quartz_bricks"
];

let toolsAndItems = [
  "wooden_sword","stone_sword","iron_sword","golden_sword","diamond_sword","netherite_sword",
  "wooden_pickaxe","stone_pickaxe","iron_pickaxe","golden_pickaxe","diamond_pickaxe","netherite_pickaxe",
  "wooden_axe","stone_axe","iron_axe","golden_axe","diamond_axe","netherite_axe",
  "wooden_shovel","stone_shovel","iron_shovel","golden_shovel","diamond_shovel","netherite_shovel",
  "wooden_hoe","stone_hoe","iron_hoe","golden_hoe","diamond_hoe","netherite_hoe",
  "stick","apple","bread","diamond","iron_ingot"
];

let currentId = null;

function setPage(page){
  document.getElementById('mode').value = page;
  document.getElementById('itemsContainer').innerHTML = '';
  document.getElementById('pageTitle').innerHTML = page==='resource'
    ? '<b>Modo Resource Pack</b><br><span class="small">Substitui terracotas, azulejos e blocos</span>'
    : '<b>Modo Datapack</b><br><span class="small">Itens, ferramentas, blocos e propriedades customizadas</span>';
  saveProject();
}

function addFolder(){
  const folderDiv = document.createElement('div');
  folderDiv.className='folder';
  folderDiv.innerHTML=`
    <label>Nome da Pasta</label>
    <input class="folderName" value="Nova Pasta">
    <button type="button" onclick="addItem(this.parentNode)">Adicionar Item nesta Pasta</button>
    <div class="folderItems"></div>
  `;
  document.getElementById('itemsContainer').appendChild(folderDiv);
}

function addItem(parent=null){
  const mode = document.getElementById('mode').value;
  const container = parent ? parent.querySelector('.folderItems') : document.getElementById('itemsContainer');

  const div=document.createElement('div');
  div.className='item';

  let optionsSelect='';
  if(mode==='resource') {
    optionsSelect=terracotaAndTiles.map(b=>`<option>${b}</option>`).join('');
  } else {
    optionsSelect=toolsAndItems.map(b=>`<option>${b}</option>`).join('');
  }

  div.innerHTML=`
    <label>Tipo de Item</label>
    <select class="itemType">${optionsSelect}</select>

    <label>Nome do Item</label>
    <input class="itemName" placeholder="Nome no jogo">

    <label>Nome da textura / ID</label>
    <input class="texName">

    <label>Textura PNG</label>
    <input type="file" class="image" accept="image/png">

    <label><input type="checkbox" class="rotate"> Permitir rotação</label>
    <label><input type="checkbox" class="crafting" checked> Habilitar crafting</label>

    <label>Dano / Durabilidade</label>
    <input type="number" class="damage" value="0">

    <label>Inflamável</label>
    <input type="checkbox" class="flammable">

    <label>Custom JSON</label>
    <input type="file" class="modelJSON" accept=".json">

    <button type="button" onclick="removeItem(this)">Remover Item</button>
  `;

  // Remover item usado das opções globais
  const select = div.querySelector('.itemType');
  const val = select.value;
  if(mode==='resource') removeFromArray(terracotaAndTiles,val);
  else removeFromArray(toolsAndItems,val);
  refreshSelects();

  select.addEventListener('change',()=>{
    const oldVal=div.querySelector('.itemName').value;
    div.querySelector('.itemName').value=select.value;
    div.querySelector('.texName').value=select.value;
    // atualizar arrays
    if(mode==='resource') removeFromArray(terracotaAndTiles,select.value);
    else removeFromArray(toolsAndItems,select.value);
    if(oldVal) addBack(oldVal,mode);
    refreshSelects();
  });

  container.appendChild(div);
}

function removeItem(btn){
  const itemDiv=btn.parentNode;
  const mode=document.getElementById('mode').value;
  const val=itemDiv.querySelector('.itemType')?.value;
  if(mode==='resource') addBack(val,'resource');
  else addBack(val,'datapack');
  itemDiv.remove();
}

function removeFromArray(arr,val){
  const index=arr.indexOf(val);
  if(index>-1) arr.splice(index,1);
}

function addBack(val,mode){
  if(!val) return;
  if(mode==='resource' && !terracotaAndTiles.includes(val)) terracotaAndTiles.push(val);
  if(mode==='datapack' && !toolsAndItems.includes(val)) toolsAndItems.push(val);
}

function refreshSelects(){
  document.querySelectorAll('.itemType').forEach(sel=>{
    const val=sel.value;
    const options=document.getElementById('mode').value==='resource'?terracotaAndTiles:toolsAndItems;
    sel.innerHTML=options.map(o=>`<option${o===val?' selected':''}>${o}</option>`).join('');
  });
}

function collectData(){
  const items=[...document.querySelectorAll('#itemsContainer .item')].map(el=>({
    name: el.querySelector('.itemName')?.value,
    tex: el.querySelector('.texName')?.value || el.querySelector('.itemName')?.value,
    type: el.querySelector('.itemType')?.value,
    rotate: el.querySelector('.rotate')?.checked,
    crafting: el.querySelector('.crafting')?.checked,
    damage: el.querySelector('.damage')?.value,
    flammable: el.querySelector('.flammable')?.checked,
    modelJSON: el.querySelector('.modelJSON')?.files[0] || null
  }));

  const folders=[...document.querySelectorAll('.folder')].map(f=>({
    name: f.querySelector('.folderName').value,
    items:[...f.querySelectorAll('.item')].map(el=>({
      name: el.querySelector('.itemName')?.value,
      tex: el.querySelector('.texName')?.value || el.querySelector('.itemName')?.value,
      type: el.querySelector('.itemType')?.value,
      rotate: el.querySelector('.rotate')?.checked,
      crafting: el.querySelector('.crafting')?.checked,
      damage: el.querySelector('.damage')?.value,
      flammable: el.querySelector('.flammable')?.checked,
      modelJSON: el.querySelector('.modelJSON')?.files[0] || null
    }))
  }));

  return {
    mode: document.getElementById('mode').value,
    name: document.getElementById('projectName').value,
    desc: document.getElementById('projectDesc').value,
    items, folders
  };
}

function saveProject(){
  try{
    const data=collectData();
    if(!currentId) currentId=Date.now().toString();
    localStorage.setItem('project_'+currentId,JSON.stringify(data));
    refreshProjects();
  }catch{}
}

function refreshProjects(){
  const sel=document.getElementById('savedProjects');
  sel.innerHTML='<option value="">— selecionar —</option>';
  Object.keys(localStorage).filter(k=>k.startsWith('project_')).forEach(k=>{
    try{
      const data=JSON.parse(localStorage.getItem(k));
      const opt=document.createElement('option');
      opt.value=k.replace('project_','');
      opt.textContent=data.name||'(sem nome)';
      sel.appendChild(opt);
    }catch{}
  });
}

function loadProject(){
  const id=document.getElementById('savedProjects').value;
  if(!id) return;
  currentId=id;
  const data=JSON.parse(localStorage.getItem('project_'+id));
  document.getElementById('mode').value=data.mode;
  document.getElementById('projectName').value=data.name;
  document.getElementById('projectDesc').value=data.desc;
  document.getElementById('itemsContainer').innerHTML='';

  data.folders.forEach(f=>{
    addFolder();
    const folder=document.querySelectorAll('.folder');
    const last=folder[folder.length-1];
    last.querySelector('.folderName').value=f.name;
    f.items.forEach(i=>{
      addItem(last);
      const items=last.querySelectorAll('.item');
      const lastItem=items[items.length-1];
      lastItem.querySelector('.itemName').value=i.name;
      lastItem.querySelector('.texName').value=i.tex;
      lastItem.querySelector('.itemType').value=i.type;
      lastItem.querySelector('.rotate').checked=i.rotate;
      lastItem.querySelector('.crafting').checked=i.crafting;
      lastItem.querySelector('.damage').value=i.damage;
      lastItem.querySelector('.flammable').checked=i.flammable;
    });
  });

  data.items.forEach(i=>{
    addItem();
    const items=document.querySelectorAll('#itemsContainer .item');
    const lastItem=items[items.length-1];
    lastItem.querySelector('.itemName').value=i.name;
    lastItem.querySelector('.texName').value=i.tex;
    lastItem.querySelector('.itemType').value=i.type;
    lastItem.querySelector('.rotate').checked=i.rotate;
    lastItem.querySelector('.crafting').checked=i.crafting;
    lastItem.querySelector('.damage').value=i.damage;
    lastItem.querySelector('.flammable').checked=i.flammable;
  });
}

function newProject(){
  currentId=null;
  document.getElementById('itemsContainer').innerHTML='';
  document.getElementById('projectName').value='';
  document.getElementById('projectDesc').value='';
  terracotaAndTiles=[
    "white_terracotta","orange_terracotta","magenta_terracotta",
    "light_blue_terracotta","yellow_terracotta","lime_terracotta",
    "pink_terracotta","gray_terracotta","light_gray_terracotta",
    "cyan_terracotta","purple_terracotta","blue_terracotta",
    "brown_terracotta","green_terracotta","red_terracotta",
    "black_terracotta",
    "terracotta","minecraft:bricks","minecraft:stone_bricks"
  ];
  toolsAndItems=[
    "wooden_sword","stone_sword","iron_sword","golden_sword","diamond_sword","netherite_sword",
    "wooden_pickaxe","stone_pickaxe","iron_pickaxe","golden_pickaxe","diamond_pickaxe","netherite_pickaxe",
    "wooden_axe","stone_axe","iron_axe","golden_axe","diamond_axe","netherite_axe",
    "wooden_shovel","stone_shovel","iron_shovel","golden_shovel","diamond_shovel","netherite_shovel",
    "wooden_hoe","stone_hoe","iron_hoe","golden_hoe","diamond_hoe","netherite_hoe",
    "stick","apple","bread","diamond","iron_ingot"
  ];
}

async function exportPack(){
  try{
    const data=collectData();
    const zip=new JSZip();
    if(data.mode==='resource'){
      const rp=zip.folder(data.name||'resourcepack');
      rp.file("pack.mcmeta",JSON.stringify({pack:{pack_format:15,description:data.desc||"Resource Pack"}},null,2));
      const assets=rp.folder("assets/minecraft/textures/block");

      data.items.concat(...data.folders.map(f=>f.items)).forEach(async(item)=>{
        const fileInput=document.querySelectorAll('.item').item(0).querySelector('.image');
        const file=fileInput?.files[0];
        if(file){
          const arrayBuffer=await file.arrayBuffer();
          assets.file(item.tex+".png",arrayBuffer);
        }
      });

    }else{
      const dp=zip.folder(data.name||'datapack');
      dp.file("pack.mcmeta",JSON.stringify({pack:{pack_format:15,description:data.desc||"Datapack"}},null,2));
      const dataFolder=dp.folder("data/custom_namespace");
      const recipes=dataFolder.folder("recipes");
      const blocks=dataFolder.folder("blocks");
      const functions=dataFolder.folder("functions");
      let giveAllContent='';

      data.items.concat(...data.folders.map(f=>f.items)).forEach(async(item)=>{
        const fileInput=document.querySelectorAll('.item').item(0).querySelector('.image');
        const file=fileInput?.files[0];
        const modelFile=document.querySelectorAll('.item').item(0).querySelector('.modelJSON')?.files[0];
        if(file){
          const arrayBuffer=await file.arrayBuffer();
          blocks.file(item.tex+".png",arrayBuffer);
        }
        if(modelFile){
          const modelBuffer=await modelFile.arrayBuffer();
          blocks.file(item.tex+".json",modelBuffer);
        }
        if(item.crafting){
          recipes.file(item.tex+".json",JSON.stringify({
            type:"minecraft:crafting_shaped",
            pattern:["###","###","###"],
            key:{"#":{item:"minecraft:stone"}},
            result:{item:`custom_namespace:${item.tex}`,count:1}
          },null,2));
        }
        giveAllContent+=`give @p custom_namespace:${item.tex} 1\n`;
      });

      functions.file("giveall.mcfunction",giveAllContent);
    }

    const content=await zip.generateAsync({type:"blob"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(content);
    a.download=(data.name||"minecraft_pack")+".zip";
    a.click();
    URL.revokeObjectURL(a.href);

  }catch(e){alert("Erro ao exportar:"+e.message);console.error(e);}
}

refreshProjects();
setPage('resource');
</script>
</body>
</html>
