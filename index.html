<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Editor de Resource Pack Minecraft</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<style>
body{
  font-family:Arial;
  background:#eee;
  max-width:1200px;
  margin:auto;
  padding:20px;
}

.card{
  background:#ddd;
  padding:16px;
  border-radius:10px;
  margin-bottom:20px;
}

#itemsContainer{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:16px;
}

.item{
  background:#f5f5f5;
  border-radius:10px;
  padding:10px;
  display:flex;
  flex-direction:column;
  gap:8px;
}

.preview{
  background:white;
  border-radius:8px;
  padding:6px;
  text-align:center;
  font-weight:bold;
}

.preview img{
  max-width:100%;
  border-radius:6px;
}

button{
  border:none;
  border-radius:6px;
  padding:6px;
  cursor:pointer;
  background:#ccc;
}

button:hover{background:#bbb}

#popup,#overlay{
  position:fixed;
  top:0;left:0;
  width:100%;height:100%;
  display:none;
}

#overlay{background:rgba(0,0,0,.5)}
#popup{
  background:white;
  width:400px;
  height:auto;
  margin:auto;
  padding:16px;
  border-radius:10px;
  inset:0;
}
</style>
</head>

<body>

<h1>Editor de Resource Pack</h1>

<div class="card">
  <label>Nome do projeto</label>
  <input id="projectName">

  <label>Descrição</label>
  <textarea id="projectDesc"></textarea>

  <label>Importar Resource Pack (pasta)</label>
  <input type="file" webkitdirectory multiple onchange="importResourcePack(this.files)">
</div>

<div class="card">
  <h3>Blocos configurados</h3>
  <div id="itemsContainer"></div>
</div>

<button onclick="exportPack()">Exportar</button>

<div id="overlay"></div>
<div id="popup"></div>

<script>
let displayNames={}
let uploadedImages={}
let currentProjectId=null

function importResourcePack(files){
  newProject()

  projectName.value="ResourcePack Importado"
  projectDesc.value="Importado automaticamente"

  [...files].forEach(file=>{
    if(!file.name.endsWith(".png")) return
    if(!file.webkitRelativePath.includes("textures/block")) return

    const name=file.name.replace(".png","")

    displayNames[name]=name.replace(/_/g," ").toUpperCase()
    uploadedImages[name]={file,url:URL.createObjectURL(file)}

    addItem(name)
  })

  saveProject()
}

function addItem(name){
  const div=document.createElement("div")
  div.className="item"
  div.innerHTML=`
    <div class="preview" id="preview-${name}"></div>
    <button onclick="openConfig('${name}')">Configurar</button>
    <button onclick="removeItem('${name}',this)">Remover</button>
  `
  itemsContainer.appendChild(div)
  updatePreview(name)
}

function updatePreview(name){
  const p=document.getElementById("preview-"+name)
  p.innerHTML=`
    <img src="${uploadedImages[name].url}">
    <div>${displayNames[name]}</div>
  `
}

function openConfig(name){
  popup.innerHTML=`
    <h3>${name}</h3>
    <label>Nome no jogo</label>
    <input value="${displayNames[name]}"
      oninput="displayNames['${name}']=this.value;updatePreview('${name}')">

    <label>Trocar textura</label>
    <input type="file" accept="image/png"
      onchange="setTexture('${name}',this.files[0])">

    <button onclick="downloadTexture('${name}')">Baixar textura</button>
    <button onclick="closePopup()">Fechar</button>
  `
  overlay.style.display="block"
  popup.style.display="block"
}

function setTexture(name,file){
  uploadedImages[name]={file,url:URL.createObjectURL(file)}
  updatePreview(name)
}

function downloadTexture(name){
  const a=document.createElement("a")
  a.href=uploadedImages[name].url
  a.download=name+".png"
  a.click()
}

function closePopup(){
  popup.style.display="none"
  overlay.style.display="none"
}

function removeItem(name,btn){
  delete displayNames[name]
  delete uploadedImages[name]
  btn.closest(".item").remove()
}

function newProject(){
  displayNames={}
  uploadedImages={}
  itemsContainer.innerHTML=""
}

function saveProject(){
  const id="rp_"+Date.now()
  localStorage.setItem(id,JSON.stringify({
    name:projectName.value,
    desc:projectDesc.value,
    displayNames,
    images:Object.fromEntries(
      Object.entries(uploadedImages).map(([k,v])=>[k,v.url])
    )
  }))
}

async function exportPack(){
  saveProject()

  const zip=new JSZip()
  const root=zip.folder(projectName.value||"resourcepack")

  root.file("pack.mcmeta",JSON.stringify({
    pack:{pack_format:15,description:projectDesc.value}
  },null,2))

  const tex=root.folder("assets/minecraft/textures/block")
  for(const k in uploadedImages){
    tex.file(k+".png",await uploadedImages[k].file.arrayBuffer())
  }

  const lang={}
  for(const k in displayNames){
    lang["block.minecraft."+k]=displayNames[k]
  }

  root.folder("assets/minecraft/lang")
    .file("pt_br.json",JSON.stringify(lang,null,2))

  const blob=await zip.generateAsync({type:"blob"})
  const a=document.createElement("a")
  a.href=URL.createObjectURL(blob)
  a.download="resourcepack.zip"
  a.click()
}
</script>
</body>
</html>
