<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gerador Minecraft Resource Pack</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<style>
:root {
  --bg-color: #f8f8f8;
  --text-color: #222;
  --card-bg: #e0e0e0;
  --item-bg: #f0f0f0;
  --folder-bg: #d9d9ff;
}
body {
  font-family: Arial, sans-serif;
  background: var(--bg-color);
  color: var(--text-color);
  max-width: 1200px;
  margin: auto;
  padding: 20px;
  font-size:16px;
}
h1 { text-align:center; font-size:28px; margin-bottom:20px; }
.card { background:var(--card-bg); padding:16px; border-radius:10px; margin-bottom:20px; }
button,input,select,textarea { font-size:16px; }
button { cursor:pointer; font-weight:bold; border:none; background:#d0d0d0; border-radius:8px; transition:0.2s; padding:8px 12px; }
button:hover { background:#c0c0c0; }
.item, .folder { background:var(--item-bg); padding:12px; margin:8px 0; border-radius:8px; box-sizing:border-box; position:relative; }
.folder { background:var(--folder-bg); }
.item-header { cursor:pointer; font-weight:bold; margin-bottom:8px; display:flex; justify-content:space-between; align-items:center; }
.item-content, .folder-items { display:none; margin-top:8px; }
.small { font-size:13px; opacity:0.7; margin-top:4px; display:block; }
input[type="checkbox"] { width:auto; margin-right:6px; vertical-align:middle; }
input[type="file"] { padding:4px; }
textarea { resize:vertical; }
select,input,textarea { width:100%; margin:6px 0; padding:6px 10px; border-radius:6px; border:1px solid #aaa; box-sizing:border-box; }
#itemsContainer { display:flex; flex-wrap:wrap; gap:12px; }
.item, .folder { width:calc(33% - 12px); }
#overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.4); display:none; z-index:998; }
#popup { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:#fff; border:2px solid #333; padding:20px; z-index:999; border-radius:8px; max-height:80%; overflow:auto; display:none; width:450px; }
#popup h2 { margin-top:0; text-align:center; }
.menu-config { position:fixed; top:20px; left:0; background:#ddd; padding:16px; border-radius:0 8px 8px 0; box-shadow:2px 2px 10px rgba(0,0,0,0.3);}
</style>
</head>
<body>
<h1>Gerador Minecraft Resource Pack</h1>

<div class="card" id="pageTitle"><b>Modo Resource Pack</b><br><span class="small">Substitua terracotas e blocos</span></div>

<div class="card">
  <label>Nome do projeto</label>
  <input id="projectName">
  <label>Descrição</label>
  <textarea id="projectDesc"></textarea>
  <label>Projetos salvos</label>
  <select id="savedProjects" onchange="loadProject()">
    <option value="">— selecionar —</option>
  </select>
  <button onclick="newProject()">Novo projeto</button>
</div>

<div class="card">
  <h3>Blocos / Pastas</h3>
  <div id="itemsContainer"></div>
  <button onclick="addFolder()">Adicionar Pasta</button>
  <div style="margin-top:8px;">
    <label>Escolha o bloco para criar:</label>
    <select id="blockSelector"></select>
    <button onclick="addItem()">Adicionar Bloco</button>
  </div>
</div>

<button onclick="exportPack()">Exportar</button>

<!-- Menu Configurações -->
<div class="menu-config">
  <label>Tamanho da fonte: <input type="number" id="fontSize" value="16" onchange="updateFontSize()">px</label>
  <br>
  <label>Modo: 
    <select id="themeMode" onchange="updateTheme()">
      <option value="light">Claro</option>
      <option value="dark">Escuro</option>
    </select>
  </label>
</div>

<div id="overlay"></div>
<div id="popup" class="popup"></div>

<script>
let allTerracotas=[
  "white_terracotta","orange_terracotta","magenta_terracotta","light_blue_terracotta",
  "yellow_terracotta","lime_terracotta","pink_terracotta","gray_terracotta",
  "light_gray_terracotta","cyan_terracotta","purple_terracotta","blue_terracotta",
  "brown_terracotta","green_terracotta","red_terracotta","black_terracotta",
  "terracotta","bricks","stone_bricks"
];

let availableBlocks=[...allTerracotas]; // blocos disponíveis
let currentId=null;
let uploadedImages={}; // armazenar imagens carregadas por item
let displayNames={}; // nome no jogo

function refreshBlockSelector(){
  const selector=document.getElementById('blockSelector');
  selector.innerHTML='';
  availableBlocks.forEach(b=>{
    const opt=document.createElement('option');
    opt.value=b; opt.textContent=b;
    selector.appendChild(opt);
  });
}

function addFolder(){
  const folder=document.createElement('div'); folder.className='folder';
  folder.innerHTML=`<div class="item-header">Pasta: <span class="folderName">Nova Pasta</span> 
    <button onclick="addItem(this.parentNode)">Adicionar Bloco</button>
    <button onclick="removeFolder(this)">Excluir Pasta</button>
    </div><div class="folder-items"></div>`;
  document.getElementById('itemsContainer').appendChild(folder);
}

function removeFolder(btn){ btn.closest('.folder').remove(); }

function addItem(parent=null){
  const selector=document.getElementById('blockSelector');
  if(selector.options.length===0){ alert("Nenhum bloco disponível!"); return; }
  const selectedBlock=selector.value;

  const container=parent?parent.querySelector('.folder-items'):document.getElementById('itemsContainer');
  const div=document.createElement('div'); div.className='item';
  div.innerHTML=`
    <div class="item-header">Bloco: <span class="itemType">${selectedBlock}</span> 
      <button onclick="openItemConfig(this)">Configurar</button> 
      <button onclick="removeItem(this, true)">Remover</button>
    </div>`;
  container.appendChild(div);

  // remover bloco usado da lista
  availableBlocks = availableBlocks.filter(b=>b!==selectedBlock);
  refreshBlockSelector();
}

function openItemConfig(btn){
  const itemDiv=btn.closest('.item');
  const itemName=itemDiv.querySelector('.itemType').textContent;
  const popup=document.getElementById('popup');
  popup.innerHTML=`
    <h2>Configuração: ${itemName}</h2>
    <label>Nome no jogo</label>
    <input id="displayName" value="${displayNames[itemName] || itemName}">
    <label>Selecionar imagem (PNG)</label>
    <input type="file" id="configImage" accept="image/png">
    <button onclick="saveItemConfig()">Salvar</button>
    <button onclick="closePopup()">Fechar</button>
  `;
  document.getElementById('overlay').style.display='block';
  popup.style.display='block';

  document.getElementById('configImage').addEventListener('change',(e)=>{
    const file=e.target.files[0];
    if(file) uploadedImages[itemName]=file;
  });

  document.getElementById('displayName').addEventListener('input',(e)=>{
    displayNames[itemName]=e.target.value;
  });
}

function saveItemConfig(){ closePopup(); }
function closePopup(){ document.getElementById('popup').style.display='none'; document.getElementById('overlay').style.display='none'; }

function removeItem(btn, restore=true){ 
  const blockName = btn.closest('.item').querySelector('.itemType').textContent;
  if(restore) { availableBlocks.push(blockName); refreshBlockSelector(); }
  delete uploadedImages[blockName];
  delete displayNames[blockName];
  btn.closest('.item').remove(); 
}

function collectData(){ 
  const items=[...document.querySelectorAll('#itemsContainer .item')].map(el=>({
    name:el.querySelector('.itemType')?.textContent
  }));
  return {
    name:document.getElementById('projectName').value,
    desc:document.getElementById('projectDesc').value,
    items
  };
}

function saveProject(){ 
  try{ 
    const data=collectData(); 
    if(!currentId) currentId=Date.now().toString(); 
    localStorage.setItem('project_'+currentId,JSON.stringify(data)); 
    refreshProjects(); 
  }catch{} 
}

function refreshProjects(){ 
  const sel=document.getElementById('savedProjects'); 
  sel.innerHTML='<option value="">— selecionar —</option>'; 
  Object.keys(localStorage).filter(k=>k.startsWith('project_')).forEach(k=>{
    try{ 
      const data=JSON.parse(localStorage.getItem(k)); 
      const opt=document.createElement('option'); 
      opt.value=k.replace('project_',''); 
      opt.textContent=data.name||'(sem nome)'; 
      sel.appendChild(opt); 
    }catch{} 
  }); 
}

function loadProject(){ 
  const id=document.getElementById('savedProjects').value;
  if(!id) return;
  const data=JSON.parse(localStorage.getItem('project_'+id));
  if(!data) return;
  currentId=id;
  document.getElementById('projectName').value=data.name;
  document.getElementById('projectDesc').value=data.desc;
  document.getElementById('itemsContainer').innerHTML='';
  uploadedImages={};
  displayNames={};
  availableBlocks=[...allTerracotas];

  data.items.forEach(item=>{
    const div=document.createElement('div'); div.className='item';
    div.innerHTML=`<div class="item-header">Bloco: <span class="itemType">${item.name}</span>
      <button onclick="openItemConfig(this)">Configurar</button>
      <button onclick="removeItem(this,true)">Remover</button>
    </div>`;
    document.getElementById('itemsContainer').appendChild(div);
    availableBlocks = availableBlocks.filter(b=>b!==item.name);
  });
  refreshBlockSelector();
}

function newProject(){ 
  currentId=null; 
  document.getElementById('itemsContainer').innerHTML=''; 
  document.getElementById('projectName').value=''; 
  document.getElementById('projectDesc').value=''; 
  uploadedImages={};
  displayNames={};
  availableBlocks=[...allTerracotas];
  refreshBlockSelector();
}

async function exportPack(){
  try{
    const data=collectData();
    const zip=new JSZip();
    const rp=zip.folder(data.name||'resourcepack');
    rp.file("pack.mcmeta",JSON.stringify({pack:{pack_format:15,description:data.desc||"Resource Pack"}},null,2));

    // Texturas
    const assets=rp.folder("assets").folder("minecraft").folder("textures").folder("block");
    for(const item of data.items){
      const file=uploadedImages[item.name];
      if(file){
        const content=await file.arrayBuffer();
        assets.file(item.name+".png",content);
      }
    }

    // Nome no jogo
    const langFolder=rp.folder("assets").folder("minecraft").folder("lang");
    const langObj={};
    for(const item of data.items){
      langObj["block.minecraft."+item.name]=displayNames[item.name]||item.name;
    }
    langFolder.file("pt_br.json",JSON.stringify(langObj,null,2));

    const content=await zip.generateAsync({type:"blob"});
    const a=document.createElement("a"); 
    a.href=URL.createObjectURL(content); 
    a.download=(data.name||"resourcepack")+".zip"; 
    a.click(); 
    URL.revokeObjectURL(a.href);
  }catch(e){ alert("Erro ao exportar:"+e.message); console.error(e);}
}

// Menu Config
function updateFontSize(){ document.body.style.fontSize=document.getElementById('fontSize').value+'px'; }
function updateTheme(){
  const theme=document.getElementById('themeMode').value;
  if(theme==='dark'){
    document.documentElement.style.setProperty('--bg-color','#222');
    document.documentElement.style.setProperty('--text-color','#f8f8f8');
    document.documentElement.style.setProperty('--card-bg','#333');
    document.documentElement.style.setProperty('--item-bg','#444');
    document.documentElement.style.setProperty('--folder-bg','#6666ff');
  } else {
    document.documentElement.style.setProperty('--bg-color','#f8f8f8');
    document.documentElement.style.setProperty('--text-color','#222');
    document.documentElement.style.setProperty('--card-bg','#e0e0e0');
    document.documentElement.style.setProperty('--item-bg','#f0f0f0');
    document.documentElement.style.setProperty('--folder-bg','#d9d9ff');
  }
}

refreshProjects();
refreshBlockSelector();
</script>
</body>
</html>
