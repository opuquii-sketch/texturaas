<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gerador Minecraft Resource Pack</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<style>
:root{
  --bg:#f8f8f8;
  --text:#222;
  --card:#e0e0e0;
  --item:#f0f0f0;
}
body{
  font-family:Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
  max-width:1200px;
  margin:auto;
  padding:20px;
}
h1{text-align:center}
.card{
  background:var(--card);
  padding:16px;
  border-radius:10px;
  margin-bottom:20px;
}
button{
  cursor:pointer;
  border:none;
  padding:6px 10px;
  border-radius:6px;
}
select,input,textarea{
  width:100%;
  margin:6px 0;
  padding:6px;
}
#itemsContainer{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:12px;
}
.item{
  background:var(--item);
  border-radius:8px;
  padding:10px;
  text-align:center;
}
.preview{
  width:100%;
  aspect-ratio:1/1;
  background:#ddd;
  border-radius:6px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  overflow:hidden;
}
.preview img{
  max-width:100%;
  max-height:100%;
}
.menu-config{
  position:fixed;
  top:20px;
  left:0;
  background:#ddd;
  padding:12px;
  border-radius:0 8px 8px 0;
}
.small{font-size:12px;opacity:.7}
</style>
</head>

<body>

<h1>Gerador Minecraft Resource Pack</h1>

<div class="menu-config">
  Fonte
  <input type="number" value="16" onchange="document.body.style.fontSize=this.value+'px'">
</div>

<div class="card">
  <b>Modo Resource Pack</b><br>
  <span class="small">Substitua terracotas e blocos</span>
</div>

<div class="card">
  <label>Nome do projeto</label>
  <input id="projectName">
  <label>Descrição</label>
  <textarea id="projectDesc"></textarea>
</div>

<div class="card">
  <h3>Adicionar blocos</h3>
  <select id="blockSelector"></select>
  <button onclick="addVanillaBlock()">Adicionar bloco</button>

  <hr>

  <label><b>Importar Resource Pack (PASTA)</b></label>
  <input type="file" webkitdirectory multiple onchange="importResourcePack(this.files)">

  <hr>

  <label><b>Importar múltiplas texturas (PNG)</b></label>
  <input type="file" accept="image/png" multiple onchange="importMultiplePNGs(this.files)">
  <span class="small">Cada PNG será associado automaticamente a um bloco disponível</span>
</div>

<div class="card">
  <h3>Blocos configurados</h3>
  <div id="itemsContainer"></div>
</div>

<button onclick="exportPack()">Exportar</button>

<script>
const vanillaBlocks=[
  "white_terracotta","orange_terracotta","magenta_terracotta",
  "light_blue_terracotta","yellow_terracotta","lime_terracotta",
  "pink_terracotta","gray_terracotta","light_gray_terracotta",
  "cyan_terracotta","purple_terracotta","blue_terracotta",
  "brown_terracotta","green_terracotta","red_terracotta",
  "black_terracotta","terracotta","bricks","stone_bricks"
];

let available=[...vanillaBlocks];
let blocks={};

function refreshSelector(){
  const s=document.getElementById("blockSelector");
  s.innerHTML="";
  available.forEach(b=>{
    const o=document.createElement("option");
    o.value=b;
    o.textContent=b;
    s.appendChild(o);
  });
}

function addVanillaBlock(){
  const name=document.getElementById("blockSelector").value;
  if(!name) return;
  blocks[name]={name,texture:null,displayName:name.replace(/_/g," ")};
  available=available.filter(b=>b!==name);
  refreshSelector();
  render();
}

function importResourcePack(files){
  [...files].forEach(file=>{
    const path=file.webkitRelativePath.replace(/\\/g,"/");
    if(!path.includes("assets/minecraft/textures")) return;
    if(!file.name.endsWith(".png")) return;

    if(available.length===0) return;

    const blockName=available.shift();
    const displayName=file.name.replace(".png","").replace(/_/g," ");

    const reader=new FileReader();
    reader.onload=()=>{
      blocks[blockName]={
        name:blockName,
        texture:reader.result,
        displayName
      };
      refreshSelector();
      render();
    };
    reader.readAsDataURL(file);
  });
}

function importMultiplePNGs(files){
  [...files].forEach(file=>{
    if(!file.name.endsWith(".png")) return;
    if(available.length===0) return;

    const blockName=available.shift();
    const displayName=file.name.replace(".png","").replace(/_/g," ");

    const reader=new FileReader();
    reader.onload=()=>{
      blocks[blockName]={
        name:blockName,
        texture:reader.result,
        displayName
      };
      refreshSelector();
      render();
    };
    reader.readAsDataURL(file);
  });
}

function render(){
  const c=document.getElementById("itemsContainer");
  c.innerHTML="";
  Object.values(blocks).forEach(b=>{
    const d=document.createElement("div");
    d.className="item";
    d.innerHTML=`
      <div class="preview">
        ${b.texture ? `<img src="${b.texture}">` : b.displayName}
      </div>
      <b>${b.displayName}</b>
      <input placeholder="Nome no jogo" value="${b.displayName}"
        oninput="blocks['${b.name}'].displayName=this.value">
      <input type="file" accept="image/png" onchange="setTexture('${b.name}',this.files[0])">
      ${b.texture?`<button onclick="downloadTexture('${b.name}')">Baixar textura</button>`:""}
      <button onclick="removeBlock('${b.name}')">Remover</button>
    `;
    c.appendChild(d);
  });
}

function setTexture(name,file){
  const r=new FileReader();
  r.onload=()=>{
    blocks[name].texture=r.result;
    render();
  };
  r.readAsDataURL(file);
}

function downloadTexture(name){
  const a=document.createElement("a");
  a.href=blocks[name].texture;
  a.download=name+".png";
  a.click();
}

function removeBlock(name){
  delete blocks[name];
  if(vanillaBlocks.includes(name)) available.push(name);
  refreshSelector();
  render();
}

async function exportPack(){
  const zip=new JSZip();
  const rp=zip.folder("resourcepack");

  rp.file("pack.mcmeta",JSON.stringify({
    pack:{pack_format:15,description:document.getElementById("projectDesc").value||"Resource Pack"}
  },null,2));

  const tex=rp.folder("assets/minecraft/textures/block");
  const lang=rp.folder("assets/minecraft/lang");
  const langObj={};

  for(const b of Object.values(blocks)){
    if(b.texture){
      const bin=await fetch(b.texture).then(r=>r.arrayBuffer());
      tex.file(b.name+".png",bin);
    }
    langObj["block.minecraft."+b.name]=b.displayName;
  }

  lang.file("pt_br.json",JSON.stringify(langObj,null,2));

  const blob=await zip.generateAsync({type:"blob"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="resourcepack.zip";
  a.click();
}

refreshSelector();
</script>

</body>
</html>
