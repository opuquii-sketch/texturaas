<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Gerador Minecraft Resource Pack</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<style>
body{
  font-family:Arial,sans-serif;
  background:#f2f2f2;
  max-width:1300px;
  margin:auto;
  padding:20px;
}
h1{text-align:center}

.card{
  background:#e0e0e0;
  padding:16px;
  border-radius:10px;
  margin-bottom:20px;
}

input,textarea,select,button{
  width:100%;
  padding:6px;
  margin:6px 0;
}

#itemsContainer,#importedContainer{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(180px,1fr));
  gap:12px;
}

.item{
  background:#fafafa;
  border-radius:8px;
  padding:10px;
  text-align:center;
}

.preview{
  width:96px;
  height:96px;
  background:#ddd;
  border-radius:8px;
  display:flex;
  align-items:center;
  justify-content:center;
  margin:auto;
  overflow:hidden;
  font-weight:bold;
}

.preview img{
  width:64px;
  height:64px;
  image-rendering:pixelated;
}

#gamePreview{
  background:#111;
  color:white;
  padding:16px;
  border-radius:10px;
}

.game-item{
  display:flex;
  align-items:center;
  gap:10px;
  background:#222;
  padding:8px;
  border-radius:6px;
  margin-bottom:6px;
}
</style>
</head>

<body>

<h1>Gerador Minecraft Resource Pack</h1>

<div class="card">
  <label>Nome do projeto</label>
  <input id="projectName" placeholder="Meu Resource Pack">
  <label>Descrição</label>
  <textarea id="projectDesc"></textarea>
</div>

<div class="card">
  <h3>Ícone do Resource Pack (pack.png)</h3>
  <input type="file" accept="image/png" onchange="setPackIcon(this.files[0])">
  <div class="preview" id="packPreview">Sem imagem</div>
</div>

<div class="card">
  <h3>Criar itens manualmente</h3>
  <select id="blockSelector"></select>
  <button onclick="addManualBlock()">Adicionar bloco</button>
</div>

<div class="card">
  <h3>Importar imagens PNG (múltiplas)</h3>
  <input type="file" accept="image/png" multiple onchange="importPNGs(this.files)">
</div>

<div class="card">
  <h3>Importar Resource Pack INTEIRO (PASTA)</h3>
  <input type="file" webkitdirectory multiple onchange="importResourcePack(this.files)">
</div>

<div class="card">
  <h3>Itens / Blocos configurados</h3>
  <div id="itemsContainer"></div>
</div>

<div class="card">
  <button onclick="generatePreview()">Salvar Resource Pack (Preview)</button>
</div>

<div class="card">
  <h3>Preview no jogo</h3>
  <div id="gamePreview">Nenhum preview gerado</div>
</div>

<button onclick="exportPack()">Exportar Resource Pack</button>

<script>
const vanillaBlocks=[
 "white_terracotta","orange_terracotta","magenta_terracotta",
 "light_blue_terracotta","yellow_terracotta","lime_terracotta",
 "pink_terracotta","gray_terracotta","light_gray_terracotta",
 "cyan_terracotta","purple_terracotta","blue_terracotta",
 "brown_terracotta","green_terracotta","red_terracotta",
 "black_terracotta"
];

let available=[...vanillaBlocks];
let blocks={};
let packIcon=null;

const selector=document.getElementById("blockSelector");

function refreshSelector(){
  selector.innerHTML="";
  available.forEach(b=>{
    const o=document.createElement("option");
    o.value=b;o.textContent=b;
    selector.appendChild(o);
  });
}
refreshSelector();

function resizeImage(file,size,cb){
  const img=new Image();
  const r=new FileReader();
  r.onload=()=>img.src=r.result;
  img.onload=()=>{
    const c=document.createElement("canvas");
    c.width=size;c.height=size;
    const ctx=c.getContext("2d");
    ctx.imageSmoothingEnabled=false;
    ctx.drawImage(img,0,0,size,size);
    cb(c.toDataURL("image/png"));
  };
  r.readAsDataURL(file);
}

function setPackIcon(file){
  resizeImage(file,64,(data)=>{
    packIcon=data;
    packPreview.innerHTML=`<img src="${data}">`;
  });
}

function addManualBlock(){
  if(!available.length) return;
  const id=selector.value;
  blocks[id]={id,name:id,texture:null};
  available=available.filter(b=>b!==id);
  refreshSelector();
  render();
}

function importPNGs(files){
  [...files].forEach(file=>{
    if(!available.length) return;
    const id=available.shift();
    resizeImage(file,16,(data)=>{
      blocks[id]={id,name:file.name.replace(".png",""),texture:data};
      render();
    });
  });
  refreshSelector();
}

function importResourcePack(files){
  [...files].forEach(file=>{
    if(!file.name.endsWith(".png")) return;
    if(!file.webkitRelativePath.includes("textures")) return;
    if(!available.length) return;

    const id=available.shift();
    resizeImage(file,16,(data)=>{
      blocks[id]={id,name:file.name.replace(".png",""),texture:data};
      render();
    });
  });
  refreshSelector();
}

function render(){
  const c=document.getElementById("itemsContainer");
  c.innerHTML="";
  Object.values(blocks).forEach(b=>{
    const d=document.createElement("div");
    d.className="item";
    d.innerHTML=`
      <div class="preview">
        ${b.texture?`<img src="${b.texture}">`:b.name}
      </div>
      <input value="${b.name}" 
        placeholder="Nome no jogo"
        onchange="blocks['${b.id}'].name=this.value">
      <small>${b.id}</small>
    `;
    c.appendChild(d);
  });
}

function generatePreview(){
  const gp=document.getElementById("gamePreview");
  gp.innerHTML="";
  Object.values(blocks).forEach(b=>{
    const div=document.createElement("div");
    div.className="game-item";
    div.innerHTML=`
      <img src="${b.texture||''}" width="32" height="32">
      <span>${b.name}</span>
    `;
    gp.appendChild(div);
  });
}

async function exportPack(){
  const zip=new JSZip();

  function textIcon(){
    const c=document.createElement("canvas");
    c.width=64;c.height=64;
    const ctx=c.getContext("2d");
    ctx.fillStyle="#fff";
    ctx.fillRect(0,0,64,64);
    ctx.fillStyle="#000";
    ctx.font="bold 14px Arial";
    ctx.textAlign="center";
    ctx.textBaseline="middle";
    ctx.fillText(
      (projectName.value||"PACK").slice(0,8),
      32,32
    );
    return c.toDataURL();
  }

  const icon=packIcon||textIcon();
  zip.file("pack.png",await fetch(icon).then(r=>r.arrayBuffer()));

  zip.file("pack.mcmeta",JSON.stringify({
    pack:{pack_format:15,description:projectDesc.value}
  },null,2));

  const tex=zip.folder("assets/minecraft/textures/block");
  const lang=zip.folder("assets/minecraft/lang");
  const langObj={};

  for(const b of Object.values(blocks)){
    if(b.texture){
      const bin=await fetch(b.texture).then(r=>r.arrayBuffer());
      tex.file(b.id+".png",bin);
    }
    langObj["block.minecraft."+b.id]=b.name;
  }

  lang.file("pt_br.json",JSON.stringify(langObj,null,2));

  const blob=await zip.generateAsync({type:"blob"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="resourcepack.zip";
  a.click();
}
</script>

</body>
</html>
